name: Notify Discord on PR

on:
  pull_request:
    branches: [ main, develop ]
    types: [opened, closed]  # âœ… PR ìƒì„±, ë‹«í˜(ë¨¸ì§€ í¬í•¨)ë§Œ ê°ì§€

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord notification
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          pr_number=${{ github.event.pull_request.number }}
          pr_title="${{ github.event.pull_request.title }}"
          pr_user=${{ github.event.pull_request.user.login }}
          pr_url=${{ github.event.pull_request.html_url }}
          base_branch=${{ github.event.pull_request.base.ref }}
          action=${{ github.event.action }}
          merged=${{ github.event.pull_request.merged }}

          # âœ… opened ì´ê±°ë‚˜, closed+merged=true ì¸ ê²½ìš°ë§Œ ì•Œë¦¼
          if [ "$action" = "opened" ]; then
            status="ğŸŸ¢ ìƒˆ PR ìƒì„±"
          elif [ "$action" = "closed" ] && [ "$merged" = "true" ]; then
            status="âœ… PR ë¨¸ì§€ ì™„ë£Œ"
          else
            echo "ğŸ‘‰ PR action='$action', merged='$merged' â†’ ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ ìŠ¤í‚µ"
            exit 0
          fi

          payload=$(cat <<EOF
          {
            "content": "",
            "embeds": [
              {
                "title": "$status",
                "description": "**#$pr_number $pr_title**",
                "url": "$pr_url",
                "fields": [
                  { "name": "íƒ€ê²Ÿ ë¸Œëœì¹˜", "value": "$base_branch", "inline": true },
                  { "name": "ì‘ì„±ì", "value": "$pr_user", "inline": true }
                ]
              }
            ]
          }
          EOF
          )

          curl -H "Content-Type: application/json" \
               -d "$payload" \
               "$DISCORD_WEBHOOK_URL"
